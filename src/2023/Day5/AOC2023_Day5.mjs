// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.mjs";
import * as Utils$AdventOfCode from "../../Utils.mjs";

function log(prim) {
  console.log(prim);
}

function log2(prim0, prim1) {
  console.log(prim0, prim1);
}

function toString(t) {
  return "Range(" + t.start.toString() + ", " + t.end.toString() + ")";
}

function inRange(t, num) {
  if (Caml_obj.greaterequal(num, t.start)) {
    return Caml_obj.lessequal(num, t.end);
  } else {
    return false;
  }
}

var $$Range = {
  toString: toString,
  inRange: inRange
};

function toString$1(t) {
  return "SrcDestRange(Src:" + toString(t.srcRange) + ", Dest:" + toString(t.destRange) + ")";
}

function srcToDest(t, srcNum) {
  if (!inRange(t.srcRange, srcNum)) {
    return ;
  }
  var offset = srcNum - t.srcRange.start;
  return Caml_option.some(t.destRange.start + offset);
}

var SrcDestRange = {
  toString: toString$1,
  srcToDest: srcToDest
};

function toString$2(t) {
  return "AlmanacMap(" + t.srcCategory + ", " + t.destCategory + ", " + t.ranges.map(toString$1).join(", ") + ")";
}

function srcToDest$1(t, srcNum) {
  return Core__Option.getWithDefault(Core__Array.findMap(t.ranges, (function (r) {
                    return srcToDest(r, srcNum);
                  })), srcNum);
}

var AlmanacMap = {
  toString: toString$2,
  srcToDest: srcToDest$1
};

function toString$3(t) {
  return "Almanac (Seeds: " + t.seeds.map(function (prim) {
                return prim.toString();
              }).join(", ") + "\n" + t.maps.map(toString$2).join("\n") + ")";
}

function getMap(t, src) {
  return Core__Option.getExn(t.maps.find(function (m) {
                  return m.srcCategory === src;
                }));
}

var Almanac = {
  toString: toString$3,
  getMap: getMap
};

function parse(data) {
  var lines = Utils$AdventOfCode.splitDoubleNewline(data).map(function (l) {
        return Utils$AdventOfCode.splitNewline(l).map(function (prim) {
                    return prim.trim();
                  });
      });
  var seedLine = Core__Option.getExn(Core__Option.flatMap(lines[0], (function (__x) {
              return __x[0];
            })));
  var mapLines = (function (__x) {
        return __x.slice(1);
      })(lines);
  var parseSeed = function (line) {
    return Utils$AdventOfCode.splitSpace(Core__Option.getExn(line.split(": ")[1])).map(function (prim) {
                return BigInt(prim);
              });
  };
  var parseMap = function (lines) {
    var categoryLine = Core__Option.getExn(lines[0]);
    var srcDestLines = lines.slice(1);
    var match = Core__Option.getExn(Core__Option.flatMap(Utils$AdventOfCode.splitSpace(categoryLine)[0], (function (s) {
                return (function (__x) {
                            return __x.split("-to-");
                          })(s);
              })));
    if (match.length !== 2) {
      throw {
            RE_EXN_ID: "Match_failure",
            _1: [
              "AOC2023_Day5.res",
              93,
              8
            ],
            Error: new Error()
          };
    }
    var srcCategory = match[0];
    var destCategory = match[1];
    var parseRangeLine = function (l) {
      var match = Utils$AdventOfCode.splitSpace(l).map(function (prim) {
            return BigInt(prim);
          });
      if (match.length !== 3) {
        throw {
              RE_EXN_ID: "Match_failure",
              _1: [
                "AOC2023_Day5.res",
                101,
                10
              ],
              Error: new Error()
            };
      }
      var destStart = match[0];
      var srcStart = match[1];
      var len = match[2];
      var one = BigInt(1);
      return {
              srcRange: {
                start: srcStart,
                end: srcStart + len - one
              },
              destRange: {
                start: destStart,
                end: destStart + len - one
              }
            };
    };
    var ranges = srcDestLines.map(parseRangeLine);
    return {
            srcCategory: srcCategory,
            destCategory: destCategory,
            ranges: ranges
          };
  };
  var seeds = parseSeed(seedLine);
  var maps = mapLines.map(parseMap);
  return {
          seeds: seeds,
          maps: maps
        };
}

function part1(almanac) {
  var locations = almanac.seeds.map(function (s) {
        var endCat = "location";
        var _curCat = "seed";
        var _curNum = s;
        while(true) {
          var curNum = _curNum;
          var curCat = _curCat;
          var map = getMap(almanac, curCat);
          var destCategory = map.destCategory;
          var nextNum = srcToDest$1(map, curNum);
          if (destCategory === endCat) {
            return nextNum;
          }
          _curNum = nextNum;
          _curCat = destCategory;
          continue ;
        };
      });
  console.log(locations);
  return Utils$AdventOfCode.minBigIntInArray(locations);
}

function solvePart1(data) {
  var almanac = parse(data);
  var prim = toString$3(almanac);
  console.log(prim);
  var m = getMap(almanac, "seed");
  var prim$1 = srcToDest$1(m, BigInt(79)).toString();
  console.log(prim$1);
  var prim$2 = srcToDest$1(m, BigInt(14)).toString();
  console.log(prim$2);
  var prim$3 = srcToDest$1(m, BigInt(55)).toString();
  console.log(prim$3);
  var prim$4 = srcToDest$1(m, BigInt(13)).toString();
  console.log(prim$4);
  return part1(almanac);
}

function solvePart2(data) {
  return 2;
}

export {
  log ,
  log2 ,
  $$Range ,
  SrcDestRange ,
  AlmanacMap ,
  Almanac ,
  parse ,
  part1 ,
  solvePart1 ,
  solvePart2 ,
}
/* No side effect */
